clear 
close all
clc

load identified

sys = ss(A,B,C,[0,0]);
% Qn = 1e-1;
Qn = 1e2;
Rn = 6e-4;
Nn = 1e-6;
[kest,Lk,P] = kalman(sys,Qn,Rn,Nn);
[eig(A) eig(A-Lk*C)]

save('Lk','Lk')

[U,S,V] = svd(A);

optim_res = [-0.00574424861394504,-0.427063766234717,0.0213502021517765,0.886690414663103,1.17271370183219,-1.22239321930781,1.36348007747483,0.834650165238644,0.0320085777653675,-0.817754224169266,-0.778136525631851,0.623045737970819,-0.804492454766425,0.452872669485287,0.290901209531686,-0.0840785102268840,1.82289929945542,0.767563480400792,0.390421153279109,-1.32052544992285,1.48782925264536,0.756140207012307,0.775689765659508,0.685689924766189,2.03955045552092,-0.635601516123543,-2.42434631924015,0.357616073203363,0.281046107668668,0.439331494257468,-0.359647028337672,-0.785691591478291,0.151505204004198,-0.521484372997350,2.52600331771719,-2.70018468316010,-0.522980834163561,0.289710780491801,-0.694184596146530,-0.341495821495294,-0.244566245176707,0.443327659961133,-0.554575827484239,0.670208587159220,1.63475468654962,1.29318062963872,1.61381196236699,-0.422738974695016,-0.299916086677000,0.159635578109088,-1.14431968303471,-0.212433848460195,0.535700893554272,-1.31712842649176,-0.0344077410802488,0.869996809551714,0.159255942777625,0.0785896784134223,2.20256135074166,0.681443538261112,-0.110825426262450,0.101561591626505,-0.239602928176743,1.63739386794020,-0.663975237033922,0.202548411849704,0.101754248593878,-0.297578704529888,-0.702235299151161,1.17396646284573,0.407363992681484,0.811171107446223];

a1 = optim_res(1,1);
b1 = optim_res(1,2);
c1 = optim_res(1,3);
d1 = optim_res(1,4);
f1 = optim_res(1,5);
g1 = optim_res(1,6);
a2 = optim_res(1,7);
b2 = optim_res(1,8);
c2 = optim_res(1,9);
d2 = optim_res(1,10);
f2 = optim_res(1,11);
g2 = optim_res(1,12);
a3 = optim_res(1,13);
b3 = optim_res(1,14);
c3 = optim_res(1,15);
d3 = optim_res(1,16);
f3 = optim_res(1,17);
g3 = optim_res(1,18);
a4 = optim_res(1,19);
b4 = optim_res(1,20);
c4 = optim_res(1,21);
d4 = optim_res(1,22);
f4 = optim_res(1,23);
g4 = optim_res(1,24);
a5 = optim_res(1,25);
b5 = optim_res(1,26);
c5 = optim_res(1,27);
d5 = optim_res(1,28);
f5 = optim_res(1,29);
g5 = optim_res(1,30);
a6 = optim_res(1,31);
b6 = optim_res(1,32);
c6 = optim_res(1,33);
d6 = optim_res(1,34);
f6 = optim_res(1,35);
g6 = optim_res(1,36);

a7 = optim_res(1,1+36);
b7 = optim_res(1,2+36);
c7 = optim_res(1,3+36);
d7 = optim_res(1,4+36);
f7 = optim_res(1,5+36);
g7 = optim_res(1,6+36);
a8 = optim_res(1,7+36);
b8 = optim_res(1,8+36);
c8 = optim_res(1,9+36);
d8 = optim_res(1,10+36);
f8 = optim_res(1,11+36);
g8 = optim_res(1,12+36);
a9 = optim_res(1,13+36);
b9 = optim_res(1,14+36);
c9 = optim_res(1,15+36);
d9 = optim_res(1,16+36);
f9 = optim_res(1,17+36);
g9 = optim_res(1,18+36);
a10 = optim_res(1,19+36);
b10 = optim_res(1,20+36);
c10 = optim_res(1,21+36);
d10 = optim_res(1,22+36);
f10 = optim_res(1,23+36);
g10 = optim_res(1,24+36);
a11 = optim_res(1,25+36);
b11 = optim_res(1,26+36);
c11 = optim_res(1,27+36);
d11 = optim_res(1,28+36);
f11 = optim_res(1,29+36);
g11 = optim_res(1,30+36);
a12 = optim_res(1,31+36);
b12 = optim_res(1,32+36);
c12 = optim_res(1,33+36);
d12 = optim_res(1,34+36);
f12 = optim_res(1,35+36);
g12 = optim_res(1,36+36);

optim_res = [0.0185813338317231,-0.0618477742567914,0.0335811246958830,0.0172590042878435,-0.0954496226645275,-0.0550622588787940,0.00501905178462916,-0.00539513331789079,-0.0678731690625227,-0.0316177517439434,0.0684054718392349,0.0446465971001481];
a13 = optim_res(1,1);
b13 = optim_res(1,2);
c13 = optim_res(1,3);
d13 = optim_res(1,4);
f13 = optim_res(1,5);
g13 = optim_res(1,6);
a14 = optim_res(1,7);
b14 = optim_res(1,8);
c14 = optim_res(1,9);
d14 = optim_res(1,10);
f14 = optim_res(1,11);
g14 = optim_res(1,12);

optim_res = [0.305370104552012,0.143646519993955,0.00822543998129134,-0.0941694258178903,-0.0542398335140982,0.0100706490030199];

a15 = optim_res(1,1);
b15 = optim_res(1,2);
c15 = optim_res(1,3);
d15 = optim_res(1,4);
f15 = optim_res(1,5);
g15 = optim_res(1,6);

M_A = [a1,b1,c1,d1,f1,g1;a2,b2,c2,d2,f2,g2;a3,b3,c3,d3,f3,g3;a4,b4,c4,d4,f4,g4;a5,b5,c5,d5,f5,g5;a6,b6,c6,d6,f6,g6];
N_A = [a7,b7,c7,d7,f7,g7;a8,b8,c8,d8,f8,g8;a9,b9,c9,d9,f9,g9;a10,b10,c10,d10,f10,g10;a11,b11,c11,d11,f11,g11;a12,b12,c12,d12,f12,g12];
M_B = M_A;
N_C = N_A;
N_B = [a13,b13,c13,d13,f13,g13;a14,b14,c14,d14,f14,g14]';
M_C = [a15,b15,c15,d15,f15,g15];

save('M_A','M_A')
save('N_A','N_A')
save('M_B','M_B')
save('N_B','N_B')
save('M_C','M_C')
save('N_C','N_C')